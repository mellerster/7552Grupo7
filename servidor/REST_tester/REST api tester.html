<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>REST API tester - v1</title>

    <style type="text/css">
	    td.lbl {
		    text-align: right;
	    };
    </style>

    <script src="jquery-2.1.3.js"></script>

    <script>
	    $(document).ready(function(){
		    // TODO: ???
	    });

	    function runAllTests(){
		    var baseUrl = $("#txtAdress").val();

		    cleanFlags();
		    runListUsers(baseUrl);
		    runLogin(baseUrl);
		    runFault(baseUrl);
	    }

	    function runListUsers(baseUrl){
		    var httpUrl = baseUrl + $("#txtListUsers").val();
		    var httpMetodo = $("input:radio[name=httpMethod_listadosUsuarios]:checked").val();

		    var datos = { token: "fake_token" };
		    ejecutarLlamada( httpMetodo, httpUrl, datos, "LUFlag" );
	    }

	    function runLogin(baseUrl){
		    var httpUrl = baseUrl + $("#txtAutenticate").val();
		    var httpMetodo = $("input:radio[name=httpMethod_login]:checked").val();
		    var datos = {
			    userName: $("#txtUserName").val(),
			    password: $("#txtPassword").val()
		    };

		    ejecutarLlamada( httpMetodo, httpUrl, datos, "LIFlag" );
	    }

	    function runFault(baseUrl){
		    var httpUrl = baseUrl + $("#txtCualquiera").val();
		    var httpMetodo = $("input:radio[name=httpMethod_Nope]:checked").val();
		    var datos = $("#txtDatos").val();

		    ejecutarLlamada( httpMetodo, httpUrl, datos, "FFlag" );
	    }
	    
	    function ejecutarLlamada(httpMetodo, httpUrl, datos, ctrolID){
		    if (httpMetodo != "GET"){
			    datos = JSON.stringify( datos );
		    }

		    $.ajax({
			    url: httpUrl,
			    method: httpMetodo,
			    data: datos, 
			    dataType: "json"
		    })
		    .done( function(resul){
			    handleSuccess(resul, ctrolID); 
		    } )
		    .fail( function(objReq, stat, errorMsg){ 
			    handleFail(errorMsg, ctrolID); 
		    } );
	    }

	    function handleSuccess(data, ctrlID){
		    $("#" + ctrlID).show();
		    $("#" + ctrlID).attr("src", "pass.gif");
	    }

	    function handleFail(errorMsg, ctrlID){
		    $("#" + ctrlID).show();
		    $("#" + ctrlID).attr("src", "fail.gif");
	    }

	    function cleanFlags(){
		    $("#LUFlag").attr("src", "");
		    $("#LIFlag").attr("src", "");
		    $("#FFlag").attr("src", "");
	    }
    </script>
</head>
<body>
	<h1>REST API tester v1</h1>
	<div>
		<form>
			<fieldset>
				<legend>Configuracion:</legend>
				<label for="txtAdress">Dirección del servidor:</label> <input type="text" id="txtAdress" value="http://192.168.28.128:8080" style="width: 20em;" />
			</fieldset>
			<br />

			<fieldset>
				<legend>Listado de usuarios:<img id="LUFlag" width="16" height="16" /></legend>
				<table>
					<tr>
						<td class="lbl" > <label for="txtListUsers">Listado de usuarios URI:</label> </td>
						<td> <input type="text" id="txtListUsers" value="/grupo7/api/usuarios" /> </td>
					</tr>
					<tr>
						<td class="lbl" > Method: </td>
						<td>
							<input type="radio" name="httpMethod_listadosUsuarios" value="GET" id="rlu_1" checked="checked" /><label for="rlu_1">GET</label>
							<input type="radio" name="httpMethod_listadosUsuarios" value="PUT" id="rlu_2" /><label for="rlu_2">PUT</label>
							<input type="radio" name="httpMethod_listadosUsuarios" value="POST" id="rlu_3"/><label for="rlu_3">POST</label>
						</td>
					</tr>
				</table>
			</fieldset>
			<br />

			<fieldset>
				<legend>Login: <img id="LIFlag" width="14" height="14" /></legend>
				<table>
					<tr>
						<td class="lbl" > <label for="txtAutenticate">Autenticación o login URI:</label> </td>
						<td> <input type="text" id="txtAutenticate" value="/grupo7/api/sesion" /> </td>
					<tr>
					</tr>
						<td class="lbl" > <label for="txtUserName">Nombre de usuario:</label> </td>
						<td> <input type="text" id="txtUserName" value="pepe" /> </td>
					<tr>
					</tr>
						<td class="lbl" > <label for="txtPassword">Password:</label> </td>
						<td> <input type="text" id="txtPassword" value="123" /> </td>
					<tr>
					</tr>
						<td class="lbl" > Method: </td>
						<td>
							<input type="radio" name="httpMethod_login" value="GET" id="rli_1" /><label for="rli_1">GET</label>
							<input type="radio" name="httpMethod_login" value="PUT" id="rli_2" checked="checked" /><label for="rli_2">PUT</label>
							<input type="radio" name="httpMethod_login" value="POST" id="rli_3"/><label for="rli_3">POST</label>
						</td>
					</tr>
				</table>
			</fieldset>
			<br />
			
			<fieldset>
				<legend>Pedido invalido: <img id="FFlag" width="14" height="14" /></legend>
				<table>
					<tr>
						<td class="lbl" > <label for="txtCualquiera">URI no valida:</label> </td>
						<td> <input type="text" id="txtCualquiera" value="/grupo7/api/supercalifragil" /> </td>
					<tr>
					</tr>
						<td class="lbl" > <label for="txtDatos">Datos:</label> </td>
						<td> <input type="text" id="txtDatos" value="9999" /> </td>
					<tr>
					</tr>
						<td class="lbl" > Method: </td>
						<td>
							<input type="radio" name="httpMethod_Nope" value="GET" id="riv_1" /><label for="rli_1">GET</label>
							<input type="radio" name="httpMethod_Nope" value="PUT" id="riv_2" checked="checked" /><label for="rli_2">PUT</label>
							<input type="radio" name="httpMethod_Nope" value="POST" id="riv_3"/><label for="rli_3">POST</label>
						</td>
					</tr>
				</table>
			</fieldset>
			<br />
			
			<button type="button" onclick="runAllTests()">Run all tests</button> 
			<button type="button" onclick="cleanFlags()">Clear results</button> 
		</form>
	</div>
</body>
</html>

